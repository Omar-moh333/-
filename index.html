<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Parking System</title>
<style>
/* نفس التنسيقات الأصلية بدون تغيير */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Arial',sans-serif;}
:root{--primary:#2c3e50;--secondary:#3498db;--success:#27ae60;--warning:#f39c12;--danger:#e74c3c;--light:#ecf0f1;--dark:#34495e;}
body{background-color:#f5f6fa;color:#333;}
.app-container{min-height:100vh;}
.app-header{background:linear-gradient(135deg,var(--primary),var(--secondary));color:white;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;}
.logo h1{font-size:1.5rem;}
.btn{padding:0.5rem 1rem;border:none;border-radius:5px;cursor:pointer;font-weight:bold;transition:all 0.3s ease;}
.btn-primary{background-color:var(--secondary);color:white;}
.btn-success{background-color:var(--success);color:white;}
.btn-danger{background-color:var(--danger);color:white;}
.main-content{padding:2rem;max-width:1200px;margin:0 auto;}
.parking-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem;margin-top:2rem;}
.slot-card{background:white;border-radius:10px;padding:1.5rem;box-shadow:0 4px 6px rgba(0,0,0,0.1);border-left:5px solid var(--success);}
.slot-card.occupied{border-left-color:var(--danger);background-color:#f8d7da;}
.slot-card.reserved{border-left-color:var(--warning);background-color:#fff3cd;}
.slot-card.maintenance{border-left-color:var(--dark);background-color:#d6d8db;}
.slot-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;}
.slot-number{font-size:1.2rem;font-weight:bold;color:var(--primary);}
.slot-status{padding:0.3rem 0.8rem;border-radius:20px;font-size:0.8rem;font-weight:bold;}
.status-available{background-color:var(--success);color:white;}
.status-occupied{background-color:var(--danger);color:white;}
.slot-price{font-size:1.5rem;font-weight:bold;color:var(--secondary);}
.auth-form{background:white;padding:2rem;border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,0.1);max-width:400px;margin:2rem auto;}
.notification{position:fixed;top:20px;right:20px;padding:1rem;border-radius:5px;color:white;z-index:1000;}
.notification.success{background-color:var(--success);}
.notification.error{background-color:var(--danger);}
</style>
</head>
<body>
<div class="app-container">
<header class="app-header">
    <div class="logo"><h1>🚗 Smart Parking System</h1></div>
    <div class="user-actions">
        <div id="userInfo" style="display:none;">
            <span>مرحباً, <span id="userName">مستخدم</span></span>
            <button class="btn btn-danger" onclick="logout()">تسجيل خروج</button>
        </div>
        <div id="authButtons">
            <button class="btn btn-primary" onclick="showLogin()">تسجيل دخول</button>
            <button class="btn btn-success" onclick="showRegister()">إنشاء حساب</button>
        </div>
    </div>
</header>

<main class="main-content">
    <div id="parkingSection">
        <h2>المواقف المتاحة</h2>
        <div class="parking-grid" id="parkingGrid"></div>
    </div>

    <!-- نموذج الحجز -->
    <div id="bookingModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;">
        <div style="background:white;margin:5% auto;padding:2rem;border-radius:10px;max-width:500px;">
            <h2>حجز موقف</h2>
            <div id="bookingDetails"></div>
            <div class="form-group">
                <label>مدة الحجز (ساعات)</label>
                <select id="bookingDuration" class="form-control" onchange="updatePaymentDetails()">
                    <option value="1">1 ساعة</option>
                    <option value="2">2 ساعات</option>
                    <option value="3">3 ساعات</option>
                    <option value="4">4 ساعات</option>
                    <option value="8">8 ساعات</option>
                    <option value="24">24 ساعة</option>
                </select>
            </div>
            <div class="form-group">
                <label>طريقة الدفع</label>
                <select id="paymentMethod" class="form-control">
                    <option value="credit">بطاقة ائتمان</option>
                    <option value="wallet">المحفظة</option>
                    <option value="cash">نقدي</option>
                </select>
            </div>
            <button class="btn btn-success" onclick="confirmBooking()">تأكيد الحجز</button>
            <button class="btn btn-danger" onclick="closeBookingModal()">إلغاء</button>
        </div>
    </div>

    <div id="qrCodeContainer" class="qr-container" style="display:none;text-align:center;background:white;padding:2rem;border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,0.1);margin:2rem auto;max-width:300px;">
        <h2>QR Code للحجز</h2>
        <canvas id="qrCanvas"></canvas>
        <p>استخدم هذا الكود للدخول والخروج من الموقف</p>
        <button class="btn btn-primary" onclick="closeQRCode()">تم</button>
    </div>
</main>
</div>

<script>
let currentUser=null;
let selectedSlot=null;
let users=JSON.parse(localStorage.getItem('parking_users'))||[];
let bookings=JSON.parse(localStorage.getItem('parking_bookings'))||[];

// بيانات المواقف
const sampleSlots=[
    {id:1,number:"A-101",location:"كلية التعليم الصناعي",status:"available",type:"regular",price:20},
    {id:2,number:"A-102",location:"الجامعة الأهلية",status:"available",type:"regular",price:25},
    {id:3,number:"B-201",location:"كافيه ديسباسيتو",status:"occupied",type:"vip",price:30},
    {id:4,number:"B-202",location:"كافيه واحة البكري",status:"available",type:"vip",price:35},
    {id:5,number:"C-301",location:"الطابق الثاني - المنطقة الشرقية",status:"available",type:"regular",price:15},
    {id:6,number:"D-401",location:"منطقة السوق التجاري",status:"available",type:"disabled",price:10}
];

function initApp(){
    renderParkingSlots();
}

function renderParkingSlots(){
    const grid=document.getElementById('parkingGrid');
    grid.innerHTML='';
    sampleSlots.forEach(slot=>{
        const card=document.createElement('div');
        card.className=`slot-card ${slot.status}`;
        card.innerHTML=`
            <div class="slot-header">
                <div class="slot-number">${slot.number}</div>
                <div class="slot-status status-${slot.status}">${getStatusText(slot.status)}</div>
            </div>
            <p><strong>الموقع:</strong> ${slot.location}</p>
            <p><strong>النوع:</strong> ${getTypeText(slot.type)}</p>
            <div class="slot-price">${slot.price} جنيه/ساعة</div>
            ${slot.status==='available'?
                `<button class="btn btn-success" onclick="showBookingModal(${slot.id})">احجز الآن</button>`:
                `<button class="btn btn-secondary" disabled>غير متاح</button>`}
        `;
        grid.appendChild(card);
    });
}

function getStatusText(s){
    return s==='available'?'متاح':s==='occupied'?'محجوز':'صيانة';
}
function getTypeText(t){
    return t==='regular'?'عادي':t==='vip'?'مميز':'ذوي احتياجات';
}

function showBookingModal(id){
    selectedSlot=sampleSlots.find(s=>s.id===id);
    const d=document.getElementById('bookingDetails');
    d.innerHTML=`
        <p><strong>رقم الموقف:</strong> ${selectedSlot.number}</p>
        <p><strong>الموقع:</strong> ${selectedSlot.location}</p>
        <p><strong>السعر:</strong> ${selectedSlot.price} جنيه/ساعة</p>
    `;
    document.getElementById('bookingModal').style.display='block';
}
function closeBookingModal(){
    document.getElementById('bookingModal').style.display='none';
}
function updatePaymentDetails(){}

function confirmBooking(){
    const duration=parseInt(document.getElementById('bookingDuration').value);
    const total=duration*selectedSlot.price;
    showNotification(`تم الحجز بنجاح! المبلغ الإجمالي: ${total} جنيه`, 'success');
    closeBookingModal();
}

function showNotification(msg,type){
    const n=document.createElement('div');
    n.className=`notification ${type}`;
    n.textContent=msg;
    document.body.appendChild(n);
    setTimeout(()=>n.remove(),3000);
}
window.addEventListener('DOMContentLoaded',initApp);
</script>
</body>
</html>
